@extends('layouts.master')
@section('content')
<div class="container">
  <section class="window">

    <div class="top">
      <div class="inner-top">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="479.999 163 136.002 173.001" class="svg-icon">
          <g id="User_book_settings" data-name="User book settings" transform="translate(-2693 -2032)">
            <path id="Path_1" data-name="Path 1" class="cls-1" d="M36,0A36,36,0,1,1,0,36,36,36,0,0,1,36,0Z" transform="translate(3206 2195)"/>
            <path id="Subtraction_3" data-name="Subtraction 3" class="cls-1" d="M2786,2136h-50a18.983,18.983,0,0,1-19-19v-15.817c.317-.006.6-.008.908-.008a40.379,40.379,0,0,1,9.017.932c6.677,1.543,14.319,5.219,18.424,7.194,3.739,1.8,5.615,2.7,8.454,2.7a11.1,11.1,0,0,0,5.921-1.707,10.611,10.611,0,0,0,1.274-.938,11.083,11.083,0,0,0,7.2,2.645c2.837,0,4.712-.9,8.446-2.7l.008,0c2.024-.973,4.792-2.3,7.914-3.619a28.023,28.023,0,0,0,20.248,14.007A18.989,18.989,0,0,1,2786,2136Zm-17.8-32a3.113,3.113,0,0,1-1.659-.477,3.379,3.379,0,0,1-1.538-2.851v-51.891a4.145,4.145,0,0,1,1.719-3.173c.466-.4,1.086-.868,1.846-1.4,1.638-1.153,3.751-2.472,5.949-3.714a69.561,69.561,0,0,1,17.541-7.2A54.054,54.054,0,0,1,2804.18,2032a65.894,65.894,0,0,1,13.115,1.287l.345.077.321.157a7.008,7.008,0,0,1,1.18.754,4.525,4.525,0,0,1,1.859,3.579V2040H2821A16,16,0,0,0,2805,2056v8.283a28.032,28.032,0,0,0-23.309,33.929c-3.381,1.414-6.331,2.831-8.484,3.866l-.011.005-.012.005-.009,0C2770.051,2103.6,2769.211,2104,2768.2,2104Zm-14.393,0c-1.017,0-1.858-.4-4.987-1.91l-.01,0c-4.387-2.109-12.554-6.035-20.081-7.774a48.309,48.309,0,0,0-10.819-1.138,59.891,59.891,0,0,0-11.9,1.142l-.319.072h-.328a4.512,4.512,0,0,1-4.359-4.642V2088a16,16,0,0,0,16-16v-16a16,16,0,0,0-16-16v-2.145a4.525,4.525,0,0,1,1.859-3.579,6.779,6.779,0,0,1,1.18-.754l.321-.157.344-.077a65.61,65.61,0,0,1,13.118-1.287,54.028,54.028,0,0,1,12.123,1.291,69.526,69.526,0,0,1,17.54,7.2c2.194,1.239,4.307,2.559,5.95,3.714.746.526,1.365,1,1.84,1.4a4.142,4.142,0,0,1,1.724,3.177v51.891a3.375,3.375,0,0,1-1.538,2.851A3.113,3.113,0,0,1,2753.8,2104Zm-52.8-24a8.01,8.01,0,0,1-8-8v-16a8,8,0,0,1,16,0v16A8.009,8.009,0,0,1,2701,2080Zm127.991-7.606,0,0a27.927,27.927,0,0,0-15.989-8.11V2056a8,8,0,1,1,16,0v16c0,.132,0,.263-.01.392Z" transform="translate(480 232)"/>
            <path id="Union_2" data-name="Union 2" class="cls-1" d="M-374.108-230a2.308,2.308,0,0,1-2.262-1.855l-.768-3.836q-.687-.247-1.343-.557l-3.26,2.174a2.3,2.3,0,0,1-1.279.388,2.306,2.306,0,0,1-1.632-.676l-2.982-2.982a2.308,2.308,0,0,1-.288-2.912l2.173-3.259q-.31-.657-.559-1.347l-3.836-.768A2.306,2.306,0,0,1-392-247.892v-4.216a2.308,2.308,0,0,1,1.855-2.262l3.835-.767q.247-.688.557-1.344l-2.173-3.26a2.307,2.307,0,0,1,.288-2.912l2.981-2.982a2.308,2.308,0,0,1,2.912-.288l3.26,2.173q.657-.31,1.347-.558l.768-3.835A2.306,2.306,0,0,1-374.108-270h4.216a2.308,2.308,0,0,1,2.262,1.855l.767,3.835q.687.247,1.343.557l3.262-2.173a2.307,2.307,0,0,1,2.912.288l2.981,2.981a2.307,2.307,0,0,1,.288,2.912l-2.172,3.26q.311.657.559,1.348l3.834.767A2.306,2.306,0,0,1-352-252.108v4.216a2.308,2.308,0,0,1-1.855,2.262l-3.834.767q-.247.687-.557,1.343l2.174,3.261a2.31,2.31,0,0,1-.288,2.912l-2.982,2.981a2.3,2.3,0,0,1-1.632.677,2.293,2.293,0,0,1-1.279-.389l-3.259-2.172q-.658.311-1.349.559l-.767,3.835A2.306,2.306,0,0,1-369.892-230Zm-5.584-20A7.693,7.693,0,0,0-372-242.308,7.693,7.693,0,0,0-364.308-250,7.692,7.692,0,0,0-372-257.692,7.691,7.691,0,0,0-379.693-250Z" transform="translate(3661 2574)"/>
          </g>
        </svg>
        <h2 class="h2-title">Storyworld Settings</h2>
      </div>
    </div>


    <div class="middle">

      <div class="circle-container">
        <div class="circle">
          <img src="{{ URL::asset("../assets/img/girl.jpg") }}">
          <div class="titles">
            @if(!empty($data['project']))
               <h3>{{$user->fullname}}</h3>
            <p class="light">
            {{$data['project']['project_name'] }}
            </p>
          </div>
        </div>
      </div>

      <div class="block">
        <form method="POST" action="{{ url('/story-list') }}" class="add-user">
           {{ csrf_field() }}
           <input type="hidden" name="option" value="{{ $data['project_id'] }}">
           <button type="submit"><i class='icon-user-add'></i></button>
        </form>
        <h2 class="dark">Team members</h2>
      </div>

      <section class="settings">
         @if($errors->any())
            <div class="error">
               <h1>{{$errors->first()}}</h1>
            </div>
         @endif

          @if (session('status'))
              <div id="js-error" class="alert alert-success">
                  {{ session('status') }}
                  <a id="js-close">x</a>
              </div>
          @endif

          <div class="settings-container">
            </br>
               <table>
                  {{-- <thead>
                     <td>user</td>
                     <td>role</td>
                     <td></td>
                  </thead> --}}
                  <tbody class="tbody-style">
                        @foreach($data['access'] as $users)
                        <tr class="tr-style">
                           <td>
                             {{-- by default user icon --}}
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="304 392 88 176" class="svg-icon2">
                               <g id="User_Standaard" data-name="User Standaard" transform="translate(-2893 -1800)">
                                 <g id="guy">
                                   <path id="Path_1" data-name="Path 1" class="cls-1" d="M36,0A36,36,0,1,1,0,36,36,36,0,0,1,36,0Z" transform="translate(3205 2192)"/>
                                   <path id="Union_1" data-name="Union 1" class="cls-1" d="M19,96A19,19,0,0,1,0,77V47.484C0,21.259,19.7,0,44,0S88,21.259,88,47.484V77A19,19,0,0,1,69,96Z" transform="translate(3197 2272)"/>
                                 </g>
                               </g>
                             </svg>
                           </td>
                           <td class="td-style">
                             {{$users['name']}}
                           </td>

                           @if($users['role_index_id'] == 1)
                              <td>
                                <div class="td-block">
                                  Owner
                                </div>
                              </td>
                           @elseif($users['role_index_id'] == 2)
                              <td>Writer</td>
                           @elseif($users['role_index_id'] == 2)
                              <td>Reader</td>
                           @endif
                           @if($users['user_id'] !== $user['id'])
                              @if($user['role_index_id'] !== 1)

                                 <form class="" action="{{ url('/delete-from-project') }}" method="post">
                                    {{ csrf_field() }}
                                    <input type="hidden" name="option" value="{{ $data['project_id'] }}">
                                    <input type="hidden" name="user" value="{{$users['user_id']}}">
                                    <td><button style="background:red;" type="submit">X</button></td>
                                 </form>
                              @endif
                           @else

                              <form class="" action="{{ url('/delete-from-project') }}" method="post">
                                 {{ csrf_field() }}
                                 <input type="hidden" name="option" value="{{ $data['project_id'] }}">
                                 <input type="hidden" name="user" value="{{$users['user_id']}}">
                                 <td>
                                   <button type="button" name="delete" class="btn-close close"></button>
                                 </td>
                                 <td class="hidden" id="deletebuttons">

                                    <button id="cancel" class="btn-cancel" type="submit">
                                      <svg class="cancel" xmlns="http://www.w3.org/2000/svg">
                                        <polyline points="9 10 4 15 9 20"></polyline>
                                        <path d="M20 4v7a4 4 0 0 1-4 4H4"></path>
                                      </svg>
                                    </button>

                                    <button type="submit" class="btn-submit">
                                      <svg class="submit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <polyline points="20 6 9 17 4 12">
                                        </polyline>
                                      </svg>
                                    </button>
                                 </td>
                                 <td></td>
                              </form>
                           @endif
                        </tr>

                        {{-- alleen voor preview --}}
                        <tr class="tr-style">
                           <td>
                             {{-- by default user icon --}}
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="304 392 88 176" class="svg-icon2">
                               <g id="User_Standaard" data-name="User Standaard" transform="translate(-2893 -1800)">
                                 <g id="guy">
                                   <path id="Path_1" data-name="Path 1" class="cls-1" d="M36,0A36,36,0,1,1,0,36,36,36,0,0,1,36,0Z" transform="translate(3205 2192)"/>
                                   <path id="Union_1" data-name="Union 1" class="cls-1" d="M19,96A19,19,0,0,1,0,77V47.484C0,21.259,19.7,0,44,0S88,21.259,88,47.484V77A19,19,0,0,1,69,96Z" transform="translate(3197 2272)"/>
                                 </g>
                               </g>
                             </svg>
                           </td>
                           <td class="td-style">
                             {{$users['name']}}
                           </td>

                           @if($users['role_index_id'] == 1)
                              <td>
                                <div class="td-block">
                                  Owner
                                </div>
                              </td>
                           @elseif($users['role_index_id'] == 2)
                              <td>Writer</td>
                           @elseif($users['role_index_id'] == 2)
                              <td>Reader</td>
                           @endif
                           @if($users['user_id'] !== $user['id'])
                              @if($user['role_index_id'] !== 1)

                                 <form class="" action="{{ url('/delete-from-project') }}" method="post">
                                    {{ csrf_field() }}
                                    <input type="hidden" name="option" value="{{ $data['project_id'] }}">
                                    <input type="hidden" name="user" value="{{$users['user_id']}}">
                                    <td><button style="background:red;" type="submit">X</button></td>
                                 </form>
                              @endif
                           @else

                              <form class="" action="{{ url('/delete-from-project') }}" method="post">
                                 {{ csrf_field() }}
                                 <input type="hidden" name="option" value="{{ $data['project_id'] }}">
                                 <input type="hidden" name="user" value="{{$users['user_id']}}">
                                 <td>
                                   <button type="button" name="delete" class="btn-close close"></button>
                                 </td>
                                 <td class="hidden" id="deletebuttons">

                                    <button id="cancel" class="btn-cancel" type="submit">
                                      <svg class="cancel" xmlns="http://www.w3.org/2000/svg">
                                        <polyline points="9 10 4 15 9 20"></polyline>
                                        <path d="M20 4v7a4 4 0 0 1-4 4H4"></path>
                                      </svg>
                                    </button>

                                    <button type="submit" class="btn-submit">
                                      <svg class="submit" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <polyline points="20 6 9 17 4 12">
                                        </polyline>
                                      </svg>
                                    </button>
                                 </td>
                                 <td></td>
                              </form>
                           @endif
                        </tr>
                        @endforeach
                        @if(!empty($data['invites'][0]['id']))
                           @foreach($data['invites'] as $invite)
                              <tr>
                                 <td>name</td>

                                 @if($invite['role_index_id'] == 1)
                                    <td>Owner</td>
                                 @elseif($invite['role_index_id'] == 2)
                                    <td>Writer</td>
                                 @elseif($invite['role_index_id'] == 2)
                                    <td>Reader</td>
                                 @endif

                                 @if($invite['status'] == 0)
                                    <td>invited</td>
                                 @elseif($invite['status'] == 1)
                                    <td>has account</td>
                                 @endif
                              </tr>
                           @endforeach
                        @endif
                  </tbody>
               </table>

               <div class="block">
                 <form method="POST" action="{{ url('/story-list') }}" class="add-user">
                    {{ csrf_field() }}
                    <input type="hidden" name="option" value="{{ $data['project_id'] }}">
                    <button type="submit"><i class='icon-user-add'></i></button>
                 </form>
                 <h2 class="dark">Connect Social Networks</h2>
               </div>

               <form action="/dashboard/delete-page" method="POST" onsubmit="return confirm('Are you sure you want to delete your story? This cannot be reversed.');">
                  {{ csrf_field() }}
                  <input type="hidden" name="project" value="{{ $data['project_id'] }}">
                  <button type="submit" id="js-delete-story" class="btn-close close"></button>
               </form>

               <table>
                  <thead>
                     <td>name</td>
                     <td>platform</td>
                     <td></td>
                  </thead>
                  <tbody>
                     <tr>
                        @if(!empty($data['pages'][0]))
                           @foreach($data['pages'] as $page)
                              <tr>
                                 <td>{{$page['service_page_name']}}</td>

                                 @if($page['service_index'] == 0)
                                    <td>facebook</td>
                                 @elseif($page['service_index'] == 1)
                                    <td>instagram</td>
                                 @endif
                              {{-- {{$data['pages']}} --}}
                              <form class="" action="{{ url('/delete-service') }}" method="post">
                                 {{ csrf_field() }}
                                 <input type="hidden" name="option" value="{{ $data['project_id'] }}">
                                 <input type="hidden" name="id" value="{{ $page['id'] }}">
                                 <td><button style="background:red;" type="submit">X</button></td>
                              </form>
                              </tr>
                           @endforeach
                        @endif
                     </tr>
                  </tbody>
               </table>
            @endif

            <div class="add-group">
              <a class="button add" href="/{{$data['project_id']}}/instagram">add instagram</a>
              <a class="button add" href="{{ url('/add-service/'.$project_id) }}">add facebook</a>
            </div>
          </div>

          <script type="text/javascript">
          (function(d, s, id){
              var js, fjs = d.getElementsByTagName(s)[0];
              if (d.getElementById(id)) {return;}
              js = d.createElement(s); js.id = id;
              js.src = "//connect.facebook.net/en_US/sdk.js";
              fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));

          window.fbAsyncInit = function() {
            FB.init({
                appId      : '188876558188407',
                xfbml      : true,
                version    : 'v2.8'
            });
            loginCheck();
          }

          function loginCheck(){
            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    return true;
                }
                else {
                    console.log("please login to Facebook");
                    return false;
                }
            });
          }
          </script>

      </section>
    </div>


    <div class="bottom bottom-small">

    </div>

  </section>
</div>
@endsection
